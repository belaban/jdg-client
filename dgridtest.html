<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>JDG client</title>
    <!-- this cofiguration assumes that the dgrid package is located
         on the filesystem as a sibling to the dojo package -->
    <script src="../dojo/dojo.js"
            data-dojo-config="async: true"></script>

</head>
<body>

<script>
    var store=null;
</script>


<script>

    require(["dojo/_base/declare", "dojo/store/Memory", "dojo/store/Observable", "dgrid/Grid", "dgrid/Selection",
                "dgrid/Keyboard", "dgrid/OnDemandGrid", "dojo/domReady!"],
            function(declare, Memory, Observable, Grid, Selection, Keyboard, OnDemandGrid) {

                var cache=[
                    {key: "Bela",      value: "Ban"},
                    {key: "Michelle",  value: "Ban"},
                    {key: "Nicole",    value: "Ban"},
                    {key: "Jeannette", value: "Ban"},
                    {key: "Marco",     value: "Furini"}
                ]

                store=new Memory({data:cache, idProperty: "key"});
                store=new Observable(store);

                var grid = new OnDemandGrid({store: store,
                                                columns: {
                                                    key: "Key",
                                                    value: "Value"
                                                },
                                                selectionMode: "single"
                                            }, "grid");

                grid.on("dgrid-select", function(event) {
                    var key=event.rows[0].data.key;
                    var value=event.rows[0].data.value;
                    document.getElementById('key').value=key;
                    document.getElementById('value').value=value;
                });

                grid.on(".dgrid-row:click", function(event){
                    var row = grid.row(event);
                    document.getElementById('key').value=row.data.key;
                    document.getElementById('value').value=row.data.value;
                });
            });


    function display(keyname, valname) {
        var key=document.getElementById(keyname).value;
        var value=document.getElementById(valname).value;
        console.log("key=" + key + ", value=" + value);

        var element=store.get(key);
        if(element == null) {
            store.add({key: key, value: value}, {overwrite: true});
        }
        else {
            element.value=value;
            store.put(element);
        }
    }
</script>



<div id="grid"></div>
<div id="details">hello</div>
<div id="message">message here...</div>
<p/>
<form id="add" onsubmit="display('key', 'value'); return false;" action="javascript:void(0);">
    <label for='key'>Key: </label>
    <input id='key' name="Key" autofocus/>
    <label for='value'>Value:</label>
    <input id='value' name="Value"/>
    <input type='submit' name="submit" value="Submit"/>
</form>
</body>
</html>
